{"version":3,"sources":["../../../src/auth/guards/roles.guard.ts"],"sourcesContent":["import { ROLES_KEY } from '@/common/decorators/roles.decorator';\r\nimport { Injectable, CanActivate, ExecutionContext } from '@nestjs/common';\r\nimport { Reflector } from '@nestjs/core';\r\n\r\n@Injectable()\r\nexport class RolesGuard implements CanActivate {\r\n  constructor(private reflector: Reflector) {}\r\n\r\n  canActivate(context: ExecutionContext): boolean {\r\n    const roles = this.reflector.get<string[]>(ROLES_KEY, context.getHandler());\r\n    if (!roles) {\r\n      return true;\r\n    }\r\n\r\n    const request = context.switchToHttp().getRequest();\r\n\r\n    const user = request.user;\r\n    //console.log(`request.user >> ${JSON.stringify(request.user)}`);\r\n\r\n    //console.log(`user role ${user.result.roles}`);\r\n    return roles.includes(user.result.roles);\r\n  }\r\n}\r\n"],"names":["RolesGuard","canActivate","context","roles","reflector","get","ROLES_KEY","getHandler","request","switchToHttp","getRequest","user","includes","result","constructor"],"mappings":";;;;+BAKaA;;;eAAAA;;;gCALa;wBACgC;sBAChC;;;;;;;;;;AAGnB,IAAA,AAAMA,aAAN,MAAMA;IAGXC,YAAYC,OAAyB,EAAW;QAC9C,MAAMC,QAAQ,IAAI,CAACC,SAAS,CAACC,GAAG,CAAWC,yBAAS,EAAEJ,QAAQK,UAAU;QACxE,IAAI,CAACJ,OAAO;YACV,OAAO;QACT;QAEA,MAAMK,UAAUN,QAAQO,YAAY,GAAGC,UAAU;QAEjD,MAAMC,OAAOH,QAAQG,IAAI;QACzB,iEAAiE;QAEjE,gDAAgD;QAChD,OAAOR,MAAMS,QAAQ,CAACD,KAAKE,MAAM,CAACV,KAAK;IACzC;IAfAW,YAAY,AAAQV,SAAoB,CAAE;aAAtBA,YAAAA;IAAuB;AAgB7C"}